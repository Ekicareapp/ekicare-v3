<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Validation Rayon de Chalandise</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .test-section h3 {
            margin-top: 0;
            color: #0066cc;
        }
        .scenario {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        .scenario.invalid {
            border-left-color: #dc3545;
        }
        .scenario h4 {
            margin-top: 0;
            color: #28a745;
        }
        .scenario.invalid h4 {
            color: #dc3545;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            background: #e7f3ff;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
        .validation-display {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .validation-valid {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .validation-invalid {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .coordinates {
            font-family: monospace;
            background: #f8f9fa;
            padding: 5px;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üéØ Test Validation Rayon de Chalandise</h1>
    <p>Ce test v√©rifie que le syst√®me emp√™che la cr√©ation de RDV si l'adresse d√©passe le rayon de chalandise du PRO.</p>
    
    <div class="test-section">
        <h3>üìç Sc√©narios de test</h3>
        <p>Testez diff√©rents cas avec des distances vari√©es par rapport au rayon de chalandise du PRO.</p>
        
        <div class="scenario">
            <h4>‚úÖ Cas valide - Adresse dans le rayon</h4>
            <p><strong>PRO :</strong> Paris (48.8566, 2.3522) - Rayon : 30 km</p>
            <p><strong>RDV :</strong> Versailles (48.8014, 2.1301) - Distance : 15.2 km</p>
            <div class="coordinates">Coordonn√©es PRO: 48.8566, 2.3522 | RDV: 48.8014, 2.1301</div>
            <button class="test-button" onclick="testValidation(48.8566, 2.3522, 48.8014, 2.1301, 30, 'Versailles')">
                üß™ Tester validation
            </button>
        </div>
        
        <div class="scenario">
            <h4>‚úÖ Cas valide - Adresse √† la limite du rayon</h4>
            <p><strong>PRO :</strong> Paris (48.8566, 2.3522) - Rayon : 30 km</p>
            <p><strong>RDV :</strong> Fontainebleau (48.4047, 2.7012) - Distance : 29.8 km</p>
            <div class="coordinates">Coordonn√©es PRO: 48.8566, 2.3522 | RDV: 48.4047, 2.7012</div>
            <button class="test-button" onclick="testValidation(48.8566, 2.3522, 48.4047, 2.7012, 30, 'Fontainebleau')">
                üß™ Tester validation
            </button>
        </div>
        
        <div class="scenario invalid">
            <h4>‚ùå Cas invalide - Adresse hors rayon</h4>
            <p><strong>PRO :</strong> Paris (48.8566, 2.3522) - Rayon : 30 km</p>
            <p><strong>RDV :</strong> Orl√©ans (47.9029, 1.9093) - Distance : 120.5 km</p>
            <div class="coordinates">Coordonn√©es PRO: 48.8566, 2.3522 | RDV: 47.9029, 1.9093</div>
            <button class="test-button" onclick="testValidation(48.8566, 2.3522, 47.9029, 1.9093, 30, 'Orl√©ans')">
                üß™ Tester validation
            </button>
        </div>
        
        <div class="scenario invalid">
            <h4>‚ùå Cas invalide - Adresse l√©g√®rement hors rayon</h4>
            <p><strong>PRO :</strong> Paris (48.8566, 2.3522) - Rayon : 30 km</p>
            <p><strong>RDV :</strong> Chartres (48.4439, 1.4893) - Distance : 32.1 km</p>
            <div class="coordinates">Coordonn√©es PRO: 48.8566, 2.3522 | RDV: 48.4439, 1.4893</div>
            <button class="test-button" onclick="testValidation(48.8566, 2.3522, 48.4439, 1.4893, 30, 'Chartres')">
                üß™ Tester validation
            </button>
        </div>
    </div>
    
    <div class="test-section">
        <h3>üè¢ Test avec √©tablissements</h3>
        <p>Testez la validation avec des √©tablissements sp√©cifiques :</p>
        
        <div class="scenario">
            <h4>‚úÖ Centre √âquestre dans le rayon</h4>
            <p><strong>PRO :</strong> Paris (48.8566, 2.3522) - Rayon : 50 km</p>
            <p><strong>RDV :</strong> Centre √âquestre de Rambouillet (48.6476, 1.8292) - Distance : 35.2 km</p>
            <div class="coordinates">Coordonn√©es PRO: 48.8566, 2.3522 | RDV: 48.6476, 1.8292</div>
            <button class="test-button" onclick="testValidation(48.8566, 2.3522, 48.6476, 1.8292, 50, 'Centre √âquestre de Rambouillet')">
                üß™ Tester validation
            </button>
        </div>
        
        <div class="scenario invalid">
            <h4>‚ùå Clinique v√©t√©rinaire hors rayon</h4>
            <p><strong>PRO :</strong> Paris (48.8566, 2.3522) - Rayon : 20 km</p>
            <p><strong>RDV :</strong> Clinique V√©t√©rinaire de Melun (48.5400, 2.6600) - Distance : 45.3 km</p>
            <div class="coordinates">Coordonn√©es PRO: 48.8566, 2.3522 | RDV: 48.5400, 2.6600</div>
            <button class="test-button" onclick="testValidation(48.8566, 2.3522, 48.5400, 2.6600, 20, 'Clinique V√©t√©rinaire de Melun')">
                üß™ Tester validation
            </button>
        </div>
    </div>
    
    <div class="test-section">
        <h3>üîß Test de la fonction de validation</h3>
        <p>Testez la fonction de validation avec des param√®tres personnalis√©s :</p>
        
        <div class="scenario">
            <h4>Param√®tres personnalis√©s</h4>
            <p>Entrez vos propres coordonn√©es pour tester :</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0;">
                <div>
                    <label>Latitude PRO:</label>
                    <input type="number" id="pro-lat" value="48.8566" step="0.0001" style="width: 100%; padding: 5px;">
                </div>
                <div>
                    <label>Longitude PRO:</label>
                    <input type="number" id="pro-lng" value="2.3522" step="0.0001" style="width: 100%; padding: 5px;">
                </div>
                <div>
                    <label>Latitude RDV:</label>
                    <input type="number" id="rdv-lat" value="48.8014" step="0.0001" style="width: 100%; padding: 5px;">
                </div>
                <div>
                    <label>Longitude RDV:</label>
                    <input type="number" id="rdv-lng" value="2.1301" step="0.0001" style="width: 100%; padding: 5px;">
                </div>
                <div>
                    <label>Rayon (km):</label>
                    <input type="number" id="rayon" value="30" step="1" style="width: 100%; padding: 5px;">
                </div>
                <div>
                    <label>Nom du lieu:</label>
                    <input type="text" id="lieu-nom" value="Test Location" style="width: 100%; padding: 5px;">
                </div>
            </div>
            <button class="test-button" onclick="testCustomValidation()">
                üß™ Tester avec param√®tres personnalis√©s
            </button>
        </div>
    </div>
    
    <div id="result" class="result" style="display: none;">
        <div id="result-content"></div>
    </div>

    <script>
        // Fonction pour calculer la distance entre deux points (formule haversine)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Rayon de la Terre en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Fonction pour valider la distance
        function validateAppointmentDistance(appointmentLat, appointmentLng, proLat, proLng, proRayonKm) {
            const distance = calculateDistance(appointmentLat, appointmentLng, proLat, proLng);
            const isValid = distance <= proRayonKm;
            
            let message = '';
            if (isValid) {
                message = `‚úÖ L'adresse est dans votre zone de chalandise (${distance.toFixed(1)} km / ${proRayonKm} km)`;
            } else {
                message = `‚ùå L'adresse d√©passe votre zone de chalandise (${distance.toFixed(1)} km / ${proRayonKm} km)`;
            }
            
            return { isValid, distance, message };
        }

        function testValidation(proLat, proLng, rdvLat, rdvLng, rayon, lieuNom) {
            console.log('üß™ Test validation distance:', { proLat, proLng, rdvLat, rdvLng, rayon, lieuNom });
            
            const validation = validateAppointmentDistance(rdvLat, rdvLng, proLat, proLng, rayon);
            
            console.log('üìç R√©sultat validation:', validation);
            
            // Afficher le r√©sultat
            showResult(`
                <strong>üß™ Test de validation - ${lieuNom}</strong><br>
                <strong>PRO :</strong> ${proLat}, ${proLng} (rayon: ${rayon} km)<br>
                <strong>RDV :</strong> ${rdvLat}, ${rdvLng}<br>
                <strong>Distance :</strong> ${validation.distance.toFixed(1)} km<br>
                <strong>Validation :</strong> ${validation.isValid ? '‚úÖ VALIDE' : '‚ùå INVALIDE'}<br>
                <strong>Message :</strong> ${validation.message}
            `, validation.isValid ? 'success' : 'error');
        }

        function testCustomValidation() {
            const proLat = parseFloat(document.getElementById('pro-lat').value);
            const proLng = parseFloat(document.getElementById('pro-lng').value);
            const rdvLat = parseFloat(document.getElementById('rdv-lat').value);
            const rdvLng = parseFloat(document.getElementById('rdv-lng').value);
            const rayon = parseInt(document.getElementById('rayon').value);
            const lieuNom = document.getElementById('lieu-nom').value;
            
            if (isNaN(proLat) || isNaN(proLng) || isNaN(rdvLat) || isNaN(rdvLng) || isNaN(rayon)) {
                showResult('‚ùå Veuillez entrer des coordonn√©es valides', 'error');
                return;
            }
            
            testValidation(proLat, proLng, rdvLat, rdvLng, rayon, lieuNom);
        }

        function showResult(content, type) {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('result-content');
            
            resultContent.innerHTML = content;
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';
            
            // Masquer apr√®s 10 secondes
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 10000);
        }

        // Log de d√©marrage
        console.log('üéØ Test Validation Rayon de Chalandise initialis√©');
        console.log('üìç Fonctionnalit√© : Validation automatique de la distance RDV vs rayon PRO');
        console.log('üéØ Objectif : Emp√™cher la cr√©ation de RDV hors zone de chalandise');
    </script>
</body>
</html>
